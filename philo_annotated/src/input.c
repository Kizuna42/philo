/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   input.c                                            :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: kizuna <kizuna@student.42.fr>              +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2024/12/19 00:00:00 by student           #+#    #+#             */
/*   Updated: 2025/05/27 18:50:26 by kizuna           ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

/*
 * ============================================================================
 * INPUT.C - 入力検証モジュール
 * ============================================================================
 *
 * このファイルはコマンドライン引数の検証を行う関数群を含んでいます。
 * 哲学者問題では正確な引数が重要なため、以下の検証を行います：
 *
 * 1. 引数の数が正しいか（4個または5個）
 * 2. 全ての引数が数字のみで構成されているか
 * 3. 全ての引数が正の整数か
 * 4. 哲学者の数が制限内（1-200）か
 *
 * 引数の意味：
 * argv[1]: 哲学者の数 (1-200)
 * argv[2]: 死亡までの時間 (ミリ秒)
 * argv[3]: 食事時間 (ミリ秒)
 * argv[4]: 睡眠時間 (ミリ秒)
 * argv[5]: 食事回数 (オプション)
 * ============================================================================
 */

#include "philo.h"

/*
 * ============================================================================
 * check_input - メイン入力検証関数
 * ============================================================================
 *
 * この関数はコマンドライン引数の基本的な検証を行います。
 * 引数の数をチェックし、詳細な値の検証を別関数に委譲します。
 *
 * 引数:
 *   argc: コマンドライン引数の数
 *   argv: コマンドライン引数の配列
 *
 * 戻り値:
 *   0: 全ての引数が有効
 *   1: 引数にエラーがある
 *
 * 検証項目:
 *   - 引数の数が4個（必須）または5個（オプション付き）
 *   - 各引数の値が有効な範囲内
 * ============================================================================
 */
int	check_input(int argc, char **argv)
{
	/* 引数の数をチェック（4個または5個のみ有効） */
	if (argc != 5 && argc != 6)
	{
		printf("Error: Wrong number of arguments\n");
		printf("Usage: ./philo number_of_philosophers time_to_die ");
		printf("time_to_eat time_to_sleep ");
		printf("[number_of_times_each_philosopher_must_eat]\n");
		return (1);
	}

	/* 引数の値の詳細検証 */
	if (check_valid_args(argv) == 1)
		return (1);

	return (0);
}

/*
 * ============================================================================
 * check_digits - 文字列が数字のみかチェック
 * ============================================================================
 *
 * 指定された文字列が数字のみで構成されているかを検証します。
 * 負の数や小数点、文字が含まれている場合はエラーとします。
 *
 * 引数:
 *   str: 検証する文字列
 *
 * 戻り値:
 *   0: 文字列が数字のみ
 *   1: 数字以外の文字が含まれている
 *
 * 注意:
 *   この関数は負の数（'-'記号）も無効として扱います。
 *   哲学者問題では全ての値が正の整数である必要があるためです。
 * ============================================================================
 */
static int	check_digits(char *str)
{
	int	j;

	j = 0;
	while (str[j])
	{
		/* 各文字が数字かどうかをチェック */
		if (!ft_isdigit(str[j]))
		{
			printf("Error: Invalid argument '%s'\n", str);
			return (1);
		}
		j++;
	}
	return (0);
}

/*
 * ============================================================================
 * check_values - 数値の範囲と妥当性をチェック
 * ============================================================================
 *
 * 引数の数値が有効な範囲内にあるかを検証します。
 * 特に哲学者の数には上限（200人）があります。
 *
 * 引数:
 *   argv: コマンドライン引数の配列
 *   i: チェックする引数のインデックス
 *
 * 戻り値:
 *   0: 値が有効な範囲内
 *   1: 値が無効（0以下または上限超過）
 *
 * 検証項目:
 *   - 全ての値が正の整数（0より大きい）
 *   - 哲学者の数が200以下
 * ============================================================================
 */
static int	check_values(char **argv, int i)
{
	/* 全ての引数は正の整数である必要がある */
	if (ft_atoi(argv[i]) <= 0)
	{
		printf("Error: Arguments must be positive integers\n");
		return (1);
	}

	/* 哲学者の数は200人以下に制限 */
	if (ft_atoi(argv[1]) > 200)
	{
		printf("Error: Number of philosophers cannot exceed 200\n");
		return (1);
	}

	return (0);
}

/*
 * ============================================================================
 * check_valid_args - 全引数の詳細検証
 * ============================================================================
 *
 * 全てのコマンドライン引数に対して詳細な検証を実行します。
 * 各引数について文字チェックと値チェックの両方を行います。
 *
 * 引数:
 *   argv: コマンドライン引数の配列
 *
 * 戻り値:
 *   0: 全ての引数が有効
 *   1: 1つ以上の引数が無効
 *
 * 処理の流れ:
 *   1. argv[1]から順番に各引数をチェック
 *   2. 各引数について数字チェックを実行
 *   3. 各引数について値の範囲チェックを実行
 *   4. エラーが見つかった時点で即座に1を返す
 * ============================================================================
 */
int	check_valid_args(char **argv)
{
	int	i;

	i = 1;  /* argv[0]はプログラム名なので、argv[1]から開始 */
	while (argv[i])
	{
		/* 文字列が数字のみかチェック */
		if (check_digits(argv[i]) == 1)
			return (1);

		/* 数値の範囲と妥当性をチェック */
		if (check_values(argv, i) == 1)
			return (1);

		i++;
	}
	return (0);
}
